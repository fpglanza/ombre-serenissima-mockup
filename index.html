<!doctype html>
<html lang="it">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Le Ombre della Serenissima — Mockup Interattivo</title>
  <meta name="description" content="Mockup interattivo a scelte multiple — Le Ombre della Serenissima." />
  <style>
    :root{
      --bg:#0b0d12;
      --panel:#111526;
      --ink:#e9ecf1;
      --muted:#b6bed0;
      --line:rgba(255,255,255,.10);
      --accent:#c6a15b;
      --accent2:#7aa2ff;
      --shadow: 0 18px 55px rgba(0,0,0,.55);
      --radius: 18px;
    }
    *{box-sizing:border-box}
    body{
      margin:0;
      font-family: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Arial, "Apple Color Emoji","Segoe UI Emoji";
      background: radial-gradient(1200px 800px at 20% 10%, rgba(122,162,255,.10), transparent 55%),
                  radial-gradient(900px 600px at 80% 30%, rgba(198,161,91,.12), transparent 60%),
                  var(--bg);
      color:var(--ink);
      line-height:1.55;
    }
    .wrap{
      max-width: 920px;
      margin: 0 auto;
      padding: 42px 18px 60px;
    }
    header{
      display:flex;
      flex-direction:column;
      gap:10px;
      margin-bottom: 18px;
    }
    .kicker{
      color: var(--muted);
      letter-spacing:.12em;
      text-transform:uppercase;
      font-size:12px;
    }
    h1{
      margin:0;
      font-size: clamp(28px, 4.2vw, 44px);
      letter-spacing: -0.02em;
    }
    .sub{
      margin:0;
      color: var(--muted);
      max-width: 70ch;
    }
    .grid{
      display:grid;
      grid-template-columns: 1.2fr .8fr;
      gap:16px;
      margin-top: 18px;
    }
    @media (max-width: 880px){
      .grid{grid-template-columns: 1fr;}
    }
    .card{
      background: linear-gradient(180deg, rgba(255,255,255,.04), rgba(255,255,255,.02));
      border: 1px solid var(--line);
      border-radius: var(--radius);
      box-shadow: var(--shadow);
      overflow:hidden;
    }
    .card .pad{ padding: 18px 18px 16px; }
    .meta{
      display:flex;
      gap:10px;
      flex-wrap:wrap;
      margin-top: 10px;
    }
    .pill{
      font-size:12px;
      color: var(--muted);
      border: 1px solid var(--line);
      padding: 7px 10px;
      border-radius: 999px;
      background: rgba(255,255,255,.02);
    }
    .sceneTitle{
      display:flex;
      align-items:flex-end;
      justify-content:space-between;
      gap:12px;
      border-bottom: 1px solid var(--line);
      padding-bottom: 12px;
      margin-bottom: 12px;
    }
    .sceneTitle h2{
      margin:0;
      font-size:18px;
      letter-spacing:-.01em;
    }
    .progress{
      font-size:12px;
      color: var(--muted);
      white-space:nowrap;
    }
    .text{
      margin: 0;
      color: var(--ink);
      font-size: 16px;
    }
    .choices{
      display:grid;
      gap:10px;
      margin-top: 14px;
    }
    button.choice{
      width:100%;
      text-align:left;
      border: 1px solid var(--line);
      background: rgba(255,255,255,.02);
      color: var(--ink);
      padding: 12px 12px;
      border-radius: 14px;
      cursor:pointer;
      transition: transform .08s ease, border-color .15s ease, background .15s ease;
    }
    button.choice:hover{
      transform: translateY(-1px);
      border-color: rgba(255,255,255,.22);
      background: rgba(255,255,255,.04);
    }
    .choice small{
      display:block;
      color: var(--muted);
      margin-top:4px;
      font-size: 12px;
    }
    .aside h3{
      margin:0 0 10px 0;
      font-size:14px;
      color: var(--muted);
      letter-spacing:.08em;
      text-transform:uppercase;
    }
    .aside p{
      margin:0 0 12px 0;
      color: var(--muted);
      font-size: 14px;
    }
    .row{
      display:flex;
      gap:10px;
      flex-wrap:wrap;
      margin-top: 10px;
    }
    .btn{
      border: 1px solid var(--line);
      background: rgba(255,255,255,.02);
      color: var(--ink);
      padding: 10px 12px;
      border-radius: 14px;
      cursor:pointer;
    }
    .btn.primary{
      border-color: rgba(198,161,91,.55);
      background: linear-gradient(180deg, rgba(198,161,91,.18), rgba(198,161,91,.08));
    }
    .log{
      margin-top: 10px;
      border-top: 1px solid var(--line);
      padding-top: 12px;
      color: var(--muted);
      font-size: 13px;
    }
    .log ol{
      margin: 8px 0 0 18px;
      padding:0;
    }
    footer{
      margin-top: 18px;
      color: var(--muted);
      font-size: 12px;
      opacity:.9;
    }
    a{ color: var(--accent2); }
    .ending{
      border: 1px solid rgba(198,161,91,.35);
      background: linear-gradient(180deg, rgba(198,161,91,.12), rgba(255,255,255,.02));
      padding: 12px 12px;
      border-radius: 14px;
      margin-top: 14px;
    }
    .ending strong{ color: #f2e6cf; }

    .optGroup{
      margin-top: 14px;
      padding: 12px 12px;
      border: 1px solid var(--line);
      border-radius: 14px;
      background: rgba(255,255,255,.02);
    }
    .optGroup h4{
      margin:0 0 8px 0;
      font-size:13px;
      color: var(--muted);
      letter-spacing:.08em;
      text-transform:uppercase;
    }
    .optGrid{
      display:grid;
      grid-template-columns: 1fr 1fr;
      gap:10px;
    }
    @media (max-width: 520px){
      .optGrid{ grid-template-columns: 1fr; }
    }
    .optBtn{
      width:100%;
      text-align:left;
      border: 1px solid var(--line);
      background: rgba(255,255,255,.02);
      color: var(--ink);
      padding: 10px 12px;
      border-radius: 14px;
      cursor:pointer;
      transition: transform .08s ease, border-color .15s ease, background .15s ease;
    }
    .optBtn:hover{
      transform: translateY(-1px);
      border-color: rgba(255,255,255,.22);
      background: rgba(255,255,255,.04);
    }
    .optBtn.selected{
      border-color: rgba(198,161,91,.60);
      background: linear-gradient(180deg, rgba(198,161,91,.16), rgba(255,255,255,.02));
    }
    button.choice:disabled{
      opacity:.55;
      cursor:not-allowed;
      transform:none;
    }
  </style>
</head>
<body>
  <div class="wrap">
    <header>
      <div class="kicker">Mockup interattivo • Scelte multiple • 3 finali</div>
      <h1>Le Ombre della Serenissima</h1>
      <p class="sub">
        Un prototipo narrativo a bivi ambientato nella Venezia della Serenissima:
        potere, simboli e zone d’ombra tra storia e interpretazione.
      </p>
    </header>

    <section class="grid">
      <main class="card">
        <div class="pad">
          <div class="sceneTitle">
            <h2 id="scene-name">Introduzione</h2>
            <div class="progress" id="progress">0 / 4</div>
          </div>

          <p class="text" id="scene-text"></p>

          <div id="custom"></div>

          <div id="ending-box" class="ending" style="display:none"></div>

          <div class="choices" id="choices"></div>

          <div class="row" style="margin-top:14px">
            <button class="btn primary" id="startBtn">Inizia</button>
            <button class="btn" id="restartBtn" style="display:none">Ricomincia</button>
          </div>

          <div class="log" id="log" style="display:none">
            <div><strong>Percorso:</strong></div>
            <ol id="logList"></ol>
          </div>
        </div>
      </main>

      <aside class="card aside" id="aside">
        <div class="pad">
          <h3>Nota progettuale</h3>
          <p>
            Questo è un <em>mockup</em>: serve a mostrare struttura, tono e dinamica di scelta.
            L’idea può evolvere in ambiente real-time / VP, mantenendo al centro la regia dell’esperienza.
          </p>

          <h3>Come usarlo</h3>
          <p>
            Fai qualche run veloce e guarda come cambia la percezione degli eventi.
            Alla fine puoi ricominciare e provare un percorso diverso.
          </p>

          <h3>Credits</h3>
          <p>
            Concept & design: <strong>Filippo Lanza</strong><br/>
            Ruolo: creative technologist (story + interazione)
          </p>

        </div>
      </aside>
    </section>
  </div>

  <script>
    // --- STATO ---
    const player = {
      sex: null,     // "uomo" | "donna"
      ceto: null,    // "patrizio" | "popolano"
      fazione: null, // "castellani" | "nicolotti"
    };

    // --- NARRATIVA ---
    const story = {
      intro: {
        id: "intro",
        name: "Introduzione",
        text:
          "Un prototipo narrativo a bivi ambientato nella Venezia della Serenissima. " +
          "Potere, simboli e zone d’ombra tra storia e interpretazione.\n\n" +
          "Questo mockup mostra il ritmo dell’esperienza: ingresso, creazione del personaggio, scelte, tre esiti possibili.",
        choices: [] // nessuna scelta: solo tasto Inizia
      },

      character: {
        id: "character",
        name: "Creazione del personaggio",
        custom: "character",
        text:
          "Prima di entrare in scena, scegli da quale punto della città guardare gli eventi. " +
          "Le differenze non cambiano drasticamente la trama: colorano la tua posizione, il modo in cui vieni letto, le ombre che ti seguono.",
        next: "start"
      },

      start: {
        id: "start",
        name: "Sotto le arcate",
        useFlavor: true,
        text:
          "È tardi. La luce si frange sui masegni umidi e Venezia sembra ascoltare. " +
          "Un messaggero ti consegna un sigillo: non è un invito, è una convocazione.\n\n" +
          "La città ha molte facce. Stasera ti chiede di scegliere da quale entrare.",
        choices: [
          { label: "Seguire il Canal Grande fino a Palazzo", hint: "Via ufficiale, regole chiare.", next: "palazzo" },
          { label: "Tagliare per calli e campielli, senza farsi notare", hint: "Via obliqua, orecchio alla città.", next: "calli" },
        ],
      },

      palazzo: {
        id: "palazzo",
        name: "Anticamera del potere",
        useFlavor: true,
        text:
          "Nel silenzio dell’anticamera, l’aria sa di cera e tessuti pesanti. " +
          "Un funzionario ti osserva come si osserva un documento: cercando il timbro giusto.\n\n" +
          "Sul tavolo, due oggetti: una mappa commerciale e un piccolo amuleto d’osso.",
        choices: [
          { label: "Aprire la mappa e chiedere un nome", hint: "Vai al nodo politico.", next: "politica" },
          { label: "Toccare l’amuleto e ascoltare cosa “risponde”", hint: "Vai al nodo simbolico.", next: "simbolo" },
        ],
      },

      calli: {
        id: "calli",
        name: "La città laterale",
        useFlavor: true,
        text:
          "Ti muovi dove Venezia non posa lo sguardo ufficiale. Una porta socchiusa, una scala che non porta “da nessuna parte”. " +
          "In un cortile interno, qualcuno ha tracciato segni sul muro: sembrano indicazioni, o avvertimenti.\n\n" +
          "Una voce: “Se vuoi capire, decidi cosa sei disposto a perdere.”",
        choices: [
          { label: "Entrare comunque: cercare chi guida questo percorso", hint: "Vai al nodo politico.", next: "politica" },
          { label: "Restare fuori: decifrare i segni e costruire una lettura", hint: "Vai al nodo simbolico.", next: "simbolo" },
        ],
      },

      politica: {
        id: "politica",
        name: "Il patto",
        useFlavor: true,
        text:
          "Ti viene proposta una verità spendibile: ordinata, utile, convincente. " +
          "Ma ogni verità, qui, ha un prezzo che non compare nei registri.\n\n" +
          "Puoi accettare il patto e diventare parte del meccanismo — oppure rifiutare e restare libero, ma invisibile.",
        choices: [
          { label: "Accettare il patto", hint: "Finale 1: Ingranaggio.", next: "end_ingranaggio" },
          { label: "Rifiutare e uscire", hint: "Finale 2: Soglia.", next: "end_soglia" },
        ],
      },

      simbolo: {
        id: "simbolo",
        name: "Il segno",
        useFlavor: true,
        text:
          "La città parla per simboli: non dicono cosa pensare, ma come guardare. " +
          "Ti accorgi che alcuni luoghi sono montati come un film: inquadrature, attese, ellissi.\n\n" +
          "Se segui il segno fino in fondo, rischi di cambiare prospettiva per sempre.",
        choices: [
          { label: "Seguire il segno fino al punto cieco", hint: "Finale 3: Camera Oscura.", next: "end_cameraoscura" },
          { label: "Spezzare il percorso e tornare indietro", hint: "Finale 2: Soglia.", next: "end_soglia" },
        ],
      },

      end_ingranaggio: {
        id: "end_ingranaggio",
        name: "Finale — Ingranaggio",
        ending: true,
        resultTitle: "Ingranaggio",
        resultText:
          "Accetti. Il sistema ti riconosce: ti concede accesso e ti chiede in cambio fedeltà al suo ritmo. " +
          "Venezia ti apre una porta… e ne chiude altre, senza rumore.",
      },

      end_soglia: {
        id: "end_soglia",
        name: "Finale — Soglia",
        ending: true,
        resultTitle: "Soglia",
        resultText:
          "Ti sottrai. Non c’è applauso, né condanna: solo la sensazione di aver evitato una narrazione già scritta. " +
          "Rimani sulla soglia, dove la città è più vera perché non ti deve convincere.",
      },

      end_cameraoscura: {
        id: "end_cameraoscura",
        name: "Finale — Camera Oscura",
        ending: true,
        resultTitle: "Camera Oscura",
        resultText:
          "Segui il segno fino al punto cieco. Non trovi “la risposta”, trovi un dispositivo: " +
          "una nuova regia dello sguardo. Da qui, ogni storia è un montaggio — e tu sei dentro l’inquadratura.",
      },
    };

    // Progressione: character -> start -> nodo2 -> nodo3 -> finale = 5
    const TOTAL_STEPS = 5;

    const els = {
      name: document.getElementById("scene-name"),
      text: document.getElementById("scene-text"),
      custom: document.getElementById("custom"),
      choices: document.getElementById("choices"),
      progress: document.getElementById("progress"),
      startBtn: document.getElementById("startBtn"),
      restartBtn: document.getElementById("restartBtn"),
      log: document.getElementById("log"),
      logList: document.getElementById("logList"),
      endingBox: document.getElementById("ending-box"),
      aside: document.getElementById("aside"),
    };

    let path = [];
    let current = story.intro;

    function pronome(){
      // semplice, senza iper-correzioni: flavour, non grammatica perfetta
      if(player.sex === "donna") return "Sei una donna";
      if(player.sex === "uomo") return "Sei un uomo";
      return "Sei qualcuno";
    }

    function flavorLine(){
      const parts = [];
      if(player.sex) parts.push(pronome().toLowerCase());
      if(player.ceto) parts.push(player.ceto);
      if(player.fazione) parts.push(player.fazione);
      if(!parts.length) return "";
      // es: "Sei un uomo, popolano, nicolotti."
      const first = pronome();
      const rest = [player.ceto, player.fazione].filter(Boolean).join(", ");
      return rest ? `${first}, ${rest}.` : `${first}.`;
    }

    function computeProgress(node){
      // intro non conta
      if(node.id === "intro") return {cur: 0, total: TOTAL_STEPS};
      if(node.id === "character") return {cur: 1, total: TOTAL_STEPS};
      if(node.id === "start") return {cur: 2, total: TOTAL_STEPS};
      if(node.id === "palazzo" || node.id === "calli") return {cur: 3, total: TOTAL_STEPS};
      if(node.id === "politica" || node.id === "simbolo") return {cur: 4, total: TOTAL_STEPS};
      if(node.ending) return {cur: 5, total: TOTAL_STEPS};
      return {cur: 0, total: TOTAL_STEPS};
    }

    function setScene(node){
      current = node;

      // toggle aside: visibile solo in intro
      if(els.aside){
        els.aside.style.display = (node.id === "intro") ? "" : "none";
      }

      els.name.textContent = node.name;
      els.custom.innerHTML = "";
      els.choices.innerHTML = "";
      els.endingBox.style.display = "none";

      // testo (con flavour se previsto)
      const baseText = node.text || "";
      const fl = (node.useFlavor && (player.sex || player.ceto || player.fazione)) ? `

${flavorLine()}` : "";
      els.text.textContent = baseText + fl;

      // progress
      const p = computeProgress(node);
      els.progress.textContent = `${p.cur} / ${p.total}`;

      // bottoni start/restart
      els.startBtn.style.display = (node.id === "intro") ? "inline-block" : "none";
      els.restartBtn.style.display = node.ending ? "inline-block" : "none";

      // ending
      if(node.ending){
        renderEnding(node);
        renderLog(true);
        return;
      }

      // custom scene: character creator
      if(node.custom === "character"){
        renderCharacterCreator();
        renderLog(false);
        return;
      }

      // normal choices
      if(node.choices && node.choices.length){
        node.choices.forEach((c, idx) => {
          const btn = document.createElement("button");
          btn.className = "choice";
          btn.type = "button";
          btn.innerHTML = `${c.label}<small>${c.hint || ""}</small>`;
          btn.addEventListener("click", () => choose(idx));
          els.choices.appendChild(btn);
        });
      }

      renderLog(false);
    }

    function renderEnding(node){
      els.endingBox.style.display = "block";
      els.endingBox.innerHTML = `<strong>${node.resultTitle}</strong><div style="margin-top:6px;color:var(--muted)">${node.resultText}</div>`;
    }

    function choose(choiceIndex){
      const choice = current.choices[choiceIndex];
      path.push({ scene: current.name, choice: choice.label });
      const nextNode = story[choice.next];
      setScene(nextNode);
    }

    function renderLog(show){
      if(!path.length){
        els.log.style.display = "none";
        return;
      }
      els.log.style.display = show ? "block" : "block";
      els.logList.innerHTML = "";
      path.forEach(step => {
        const li = document.createElement("li");
        li.textContent = `${step.scene} → ${step.choice}`;
        els.logList.appendChild(li);
      });
    }

    function reset(){
      path = [];
      player.sex = null;
      player.ceto = null;
      player.fazione = null;
      setScene(story.intro);
    }

    // --- CREAZIONE PERSONAGGIO ---
    function renderCharacterCreator(){
      const container = document.createElement("div");

      const groups = [
        {
          key: "sex",
          title: "Sesso",
          options: [
            { value: "uomo", label: "Uomo", hint: "Accesso più “lineare” ai luoghi formali. Sguardo spesso dato per scontato." },
            { value: "donna", label: "Donna", hint: "Presenza più ambigua per la città: ascolti, filtri, percorsi indiretti." },
          ]
        },
        {
          key: "ceto",
          title: "Ceto",
          options: [
            { value: "patrizio", label: "Patrizio", hint: "Vicino ai palazzi, alle regole, ai favori. Anche alle aspettative." },
            { value: "popolano", label: "Popolano", hint: "Vicino alle calli, alle voci, al lavoro. Anche agli sguardi altrui." },
          ]
        },
        {
          key: "fazione",
          title: "Fazione",
          options: [
            { value: "castellani", label: "Castellani", hint: "Dalla parte di San Marco. Tradizione e orgoglio di sponda." },
            { value: "nicolotti", label: "Nicolotti", hint: "Dalla parte di San Nicolò. Rivalità antiche, solidarietà di riva." },
          ]
        },
      ];

      groups.forEach(g => {
        const box = document.createElement("div");
        box.className = "optGroup";
        box.innerHTML = `<h4>${g.title}</h4>`;
        const grid = document.createElement("div");
        grid.className = "optGrid";

        g.options.forEach(opt => {
          const btn = document.createElement("button");
          btn.type = "button";
          btn.className = "optBtn";
          btn.innerHTML = `${opt.label}<small style="display:block;color:var(--muted);margin-top:4px;font-size:12px">${opt.hint}</small>`;
          btn.addEventListener("click", () => {
            player[g.key] = opt.value;
            // toggle selected
            [...grid.querySelectorAll(".optBtn")].forEach(b => b.classList.remove("selected"));
            btn.classList.add("selected");
            updateContinue();
          });
          grid.appendChild(btn);
        });

        box.appendChild(grid);
        container.appendChild(box);
      });

      els.custom.appendChild(container);

      // Bottone continua (in area choices)
      const cont = document.createElement("button");
      cont.className = "choice";
      cont.type = "button";
      cont.disabled = true;
      cont.innerHTML = `Entra in città<small>Prosegui con il personaggio selezionato.</small>`;
      cont.addEventListener("click", () => {
        path.push({ scene: "Creazione del personaggio", choice: `Sesso: ${player.sex}` });
        path.push({ scene: "Creazione del personaggio", choice: `Ceto: ${player.ceto}` });
        path.push({ scene: "Creazione del personaggio", choice: `Fazione: ${player.fazione}` });
        setScene(story[story.character.next]);
      });
      els.choices.appendChild(cont);

      function updateContinue(){
        cont.disabled = !(player.sex && player.ceto && player.fazione);
      }
    }

    // --- EVENTI UI ---
    els.startBtn.addEventListener("click", () => {
      // Primo click: entra nell'avventura (creazione personaggio) e nasconde la nota progettuale
      setScene(story.character);
    });

    els.restartBtn.addEventListener("click", reset);

    // Stato iniziale: intro senza scelte
    setScene(story.intro);
  </script>

</body>
</html>